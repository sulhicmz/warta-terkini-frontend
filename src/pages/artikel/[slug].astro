---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getPosts, getPostBySlug } from '../../services/wordpress';

export async function getStaticPaths() {
  const posts = await getPosts();
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const post = await getPostBySlug(slug);

if (!post) {
  return Astro.redirect('/404'); // Redirect to a 404 page if post not found
}
---

<BaseLayout title={post.title}>
  <article class="bg-white shadow-md rounded-lg p-6 lg:p-8">
    {post.featuredImage && (
      <img
        src={post.featuredImage}
        alt={post.title}
        class="w-full h-64 object-cover rounded-md mb-6"
      />
    )}
    <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
      {post.title}
    </h1>
    <p class="text-gray-600 text-sm mb-6">
      Oleh {post.author} pada {new Date(post.date).toLocaleDateString('id-ID', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      })}
    </p>
    <div class="prose max-w-none text-gray-800" set:html={post.content} />
  </article>
</BaseLayout>